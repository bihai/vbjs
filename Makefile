parser.js: vb.language
	echo "/* Parser generated by language.js (see Makefile) */" > parser.js
	language -g vb.language >> parser.js

vb.js: vb.coffee
	coffee -c vb.coffee

test: parser.js
    # Usage:
    #     $ make test TEST="grep pattern"
    ifdef TEST
	mocha --compilers coffee:coffee-script --ui tdd --grep "$(TEST)"
    else
	mocha --compilers coffee:coffee-script --ui tdd
    endif

.PHONY: test
